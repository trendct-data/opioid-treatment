{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Opioid treatment checkins\"\nauthor: \"Andrew Ba Tran\"\ndate: \"October 4, 2016\"\noutput: html_document\n---\n\nQuestions to ask:\n\n- Which towns had the most admissions per capita?\n- Urban versus rural versus mixed admissions?\nIs there a correlation between admissions and overdose deaths? (By year)\n\nWhere do people tend to die (urban, rural, mixed)\n\ndistance to clinics, pharmacies, hospitals\n\ncorrelation between deaths and admissions to these distances?\n\n\n\n```{r setup, include=FALSE}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ctnamecleaner)\nlibrary(ggplot2)\nlibrary(extrafont)\nlibrary(scales)\nlibrary(rgdal)\nrequire(maptools)\nlibrary(stringr)\nlibrary(knitr)\ntreat <- read.csv(\"https://data.ct.gov/api/views/4pv7-jhxb/rows.csv?accessType=DOWNLOAD\", stringsAsFactors=F)\n\n```\n\n```{r total_town_year, message=F, warning=F, fig.width=8, fig.height=35}\n\ntreat$Admissions[is.na(treat$Admissions)] <- 0\n\ngg <- ggplot(treat, aes(y=Admissions, x=FiscalYear))\ngg <- gg + geom_bar(stat=\"identity\")\ngg <- gg + facet_wrap(~Town, ncol=4, scale=\"free_x\")\n#gg <- gg + facet_wrap(~state, scale=\"free\", ncol=5)\n#gg <- gg + scale_x_continuous(limits=c(2012,2016), breaks=c(2012,2016),\n#        labels=c(\"2012\", \"2016\"))\ngg <- gg + labs(x=NULL, y=NULL, \n                title=\"Opioid Related Treatment Admissions by Town\",\n                subtitle=\"\",\n                caption=\"Department of Mental Health and Addiction Services\")\ngg <- gg + theme_minimal(base_family=\"Lato Regular\")\ngg <- gg + theme(panel.grid.major.y=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(plot.title=element_text(family=\"Lato Black\"))\ngg\n\n\n# gg <- ggplot(treat, aes(y=Unduplicated.Clients, x=FiscalYear))\n# gg <- gg + geom_bar(stat=\"identity\")\n# gg <- gg + facet_wrap(~Town, ncol=4, scale=\"free_x\")\n# #gg <- gg + facet_wrap(~state, scale=\"free\", ncol=5)\n# #gg <- gg + scale_x_continuous(limits=c(2012,2016), breaks=c(2012,2016),\n# #        labels=c(\"2012\", \"2016\"))\n# gg <- gg + labs(x=NULL, y=NULL, \n#                 title=\"Opioid Related Treatment Admissions (unduplicated clients) by Town\",\n#                 subtitle=\"\",\n#                 caption=\"Department of Mental Health and Addiction Services\")\n# gg <- gg + theme_minimal(base_family=\"Lato Regular\")\n# gg <- gg + theme(panel.grid.major.y=element_blank())\n# gg <- gg + theme(panel.grid.minor=element_blank())\n# gg <- gg + theme(plot.title=element_text(family=\"Lato Black\"))\n# gg\n```\n\n```{r total_town_year_per_capita, message=F, warning=F, fig.width=8, fig.height=35}\n\ntreat$Admissions[is.na(treat$Admissions)] <- 0\ntreat <- ctpopulator(Town, treat)\ntreat$per_capita_a <- round(treat$Admissions/treat$pop2013*1000, 2)\n\ngg <- ggplot(treat, aes(y=per_capita_a, x=FiscalYear))\ngg <- gg + geom_bar(stat=\"identity\")\ngg <- gg + facet_wrap(~Town, ncol=4, scale=\"free_x\")\n#gg <- gg + facet_wrap(~state, scale=\"free\", ncol=5)\n#gg <- gg + scale_x_continuous(limits=c(2012,2016), breaks=c(2012,2016),\n#        labels=c(\"2012\", \"2016\"))\ngg <- gg + labs(x=NULL, y=NULL, \n                title=\"Opioid Related Treatment Admissions per 1,000 residents by Town\",\n                subtitle=\"\",\n                caption=\"Department of Mental Health and Addiction Services\")\ngg <- gg + theme_minimal(base_family=\"Lato Regular\")\ngg <- gg + theme(panel.grid.major.y=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(plot.title=element_text(family=\"Lato Black\"))\ngg\n```\n\n# Mapped\n\n```{r map1, message=F, warning=F, fig.width=9, fig.height=9}\n\ntown_shape <- readOGR(dsn=\"maps\", layer=\"ctgeo\")\ntown_shape_df <- fortify(town_shape, region=\"NAME10\")\n\nnames(treat)[names(treat) == 'Town'] <- 'id'\ntreat$id <- str_to_title(treat$id)\ntown_map <- left_join(town_shape_df, treat)\n\ngg <- ggplot(town_map, aes(long,lat, group=group, fill=per_capita_a)) \ngg <- gg +  geom_polygon()\ngg <- gg +  geom_path(color = \"grey73\")\ngg <- gg +  coord_equal()\ngg <- gg + facet_wrap(~FiscalYear, ncol=2)\ngg <- gg + scale_fill_gradient(low=\"grey73\", high=\"blue\") \ngg <- gg + labs(x=NULL, y=NULL, title=\"Opioid Related Treatment Admissions by town\",\n                subtitle=\"Per 1,000 residents\",\n                caption=\"SOURCE: Department of Mental Health and Addiction Services\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(text = element_text(size=16))\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(axis.ticks=element_blank())\ngg <- gg + theme(axis.text.x=element_blank())\ngg <- gg + theme(axis.text.y=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\n\n```\n\n# Towns with most check-ins per capita\n\n```{r table1}\ntab1 <- treat %>%\n  select(id, FiscalYear, per_capita_a) %>%\n  spread(FiscalYear, per_capita_a) %>%\n  arrange(-`2016`)\n  kable(head(tab1, 10))\n```\n\n# Check-ins by town type\n\n```{r town_type1, fig.width=9, fig.height=5, warning=F, message=F} \nsource(\"urban_rural_mixed.R\")\n\ntown_count <- town_count[c(\"NAME10\", \"Type\", \"perc_urban\")]\ncolnames(town_count) <- c(\"id\", \"town_type\", \"perc_urban\")\n\ntab2 <- treat %>%\n  select(id, FiscalYear, Admissions, pop2013, per_capita_a)\n\ntab2_joined <- left_join(tab2, town_count)\n\ngg <- ggplot(tab2_joined, aes(x=town_type, y=Admissions,fill=town_type))\ngg <- gg +  geom_boxplot()\ngg <- gg +  facet_wrap(~FiscalYear, ncol=5)\ngg <- gg + labs(x=NULL, y=\"Admissions\", title=\"Overall opioid-related checkins in Connecticut\",\n                subtitle=\"Per 1,000 residents\",\n                caption=\"SOURCE: Department of Mental Health and Addiction Services\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(text = element_text(size=16))\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg +  theme(axis.text.x=element_text(angle=90, vjust=0.4,hjust=1))\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.y=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\n\np <- ggplot(tab2_joined, aes(x=town_type, y=per_capita_a,fill=town_type))\ngg <- gg +  geom_boxplot()\ngg <- gg +  facet_grid(.~FiscalYear)\ngg <- gg + labs(x=NULL, y=\"Admissions per capita\", title=\"Overall opioid-related checkins in Connecticut\",\n                subtitle=\"Per 1,000 residents\",\n                caption=\"SOURCE: Department of Mental Health and Addiction Services\\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(text = element_text(size=16))\ngg <- gg + theme(panel.grid.major=element_blank())\ngg <- gg + theme(panel.grid.minor=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(axis.text.x=element_text(angle=90, vjust=0.4,hjust=1))\n#gg <- gg + theme(axis.ticks=element_blank())\n#gg <- gg + theme(axis.text.y=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Black\", size=22))\ngg <- gg + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(b=12)))\ngg <- gg + theme(plot.caption=element_text(size=12, margin=margin(t=10, r=80), color=\"#7a7d7e\"))\ngg <- gg + theme(plot.margin = unit(c(1, 1, 1, 1), \"lines\"))\n\ngg\n```\n\n## Looking at deaths\n\n```{r deaths, message=F, warning=F}\ndrug_deaths <- read.csv(\"https://data.ct.gov/api/views/rybz-nyjw/rows.csv?accessType=DOWNLOAD\", stringsAsFactors = F)\n\n\n\n```",
    "created" : 1475607324142.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3003172744",
    "id" : "E70A1809",
    "lastKnownWriteTime" : 1475672029,
    "last_content_update" : 1475672029594,
    "path" : "~/Documents/Github/trendct-data/2016/10/opioid-treatment/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}